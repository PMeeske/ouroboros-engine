# Notify downstream repositories when CI completes successfully
# Sends repository_dispatch events to downstream repos

name: Notify Downstream

on:
  workflow_run:
    workflows: [CI]
    types: [completed]
    branches: [main]

jobs:
  notify:
    name: Notify Downstream Repos
    runs-on: ubuntu-latest
    if: github.event.workflow_run.conclusion == 'success'
    steps:
      - name: Notify ouroboros-app
        uses: peter-evans/repository-dispatch@v3
        with:
          token: ${{ secrets.OUROBOROS_DISPATCH_PAT }}
          repository: PMeeske/ouroboros-app
          event-type: dependency-updated
          client-payload: |
            {
              "source_repo": "${{ github.event.repository.name }}",
              "source_sha": "${{ github.event.workflow_run.head_sha }}"
            }
